
# TCPDF
=======
# ๐ Stock Moves PDF Generator

ูุธุงู ูุชูุงูู ูุชูููุฏ ุชูุงุฑูุฑ PDF ุชููุงุฆูุงู ูู ุฌุฏูู ุญุฑูุงุช ุงููุฎุฒูู `0_stock_moves` ุจุงุณุชุฎุฏุงู PHP Native ู TCPDF ู OOP ูุน ูุธุงู Job Queue.

## ๐ฏ ุงููููุฒุงุช

- โ **ุชูููุฏ ุชููุงุฆู ููุชูุงุฑูุฑ**: ูู 1000 ุตู ุฌุฏูุฏ ูุชู ุฅูุดุงุก ููู PDF ุชููุงุฆูุงู
- โ **ูุธุงู Queue ูุชูุฏู**: ุฅุฏุงุฑุฉ ุงูููุงู ุจููุงุกุฉ ูุน ุชุชุจุน ุงูุญุงูุฉ
- โ **ุชุตููู OOP ูุธูู**: ููุฏ ููุธู ูุณูู ุงูุตูุงูุฉ
- โ **ูุงุฌูุฉ ูุฑุงูุจุฉ ุฌูููุฉ**: Dashboard ููุชุงุจุนุฉ ุงููุธุงู
- โ **ุชุณุฌูู ุดุงูู**: Logging ูุฌููุน ุงูุนูููุงุช ูุงูุฃุฎุทุงุก
- โ **ุชูุงุฑูุฑ ุงุญุชุฑุงููุฉ**: PDF ููุณู ุจุดูู ุฌููู ูุน ุฌุฏุงูู ูุฃููุงู

## ๐ ูููู ุงููุดุฑูุน

```
tcpdf_job_queue_stock_moves_v2/
โโโ api/
โ   โโโ run_watcher.php        # API endpoint ูุชุดุบูู Watcher
โ   โโโ run_worker.php         # API endpoint ูุชุดุบูู Worker
โโโ classes/
โ   โโโ Database.php           # ุฅุฏุงุฑุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ   โโโ ReportGenerator.php    # ุชูููุฏ ูููุงุช PDF
โ   โโโ JobWorker.php          # ูุนุงูุฌุฉ ุงูููุงู
โโโ scripts/
โ   โโโ watcher.php            # ูุฑุงูุจุฉ ุงูุฌุฏูู ูุฅุถุงูุฉ ููุงู
โ   โโโ worker.php             # ูุนุงูุฌุฉ ุงูููุงู ูุชูููุฏ PDF
โโโ reports/                   # ูุฌูุฏ ูููุงุช PDF ุงููููุฏุฉ
โโโ tcpdf/                     # ููุชุจุฉ TCPDF
โโโ db.php                     # ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
โโโ migrations.sql             # ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
โโโ index.php                  # ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
โโโ dashboard.php              # ููุญุฉ ุงูุชุญูู
โโโ reset_queue.php            # ุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู
โโโ README.md                  # ูุฐุง ุงูููู
```

## ๐ ุงูุชุซุจูุช ูุงูุฅุนุฏุงุฏ

### 1. ูุชุทูุจุงุช ุงููุธุงู

- PHP 7.4 ุฃู ุฃุญุฏุซ
- MySQL 5.7 ุฃู ุฃุญุฏุซ
- ููุชุจุฉ TCPDF (ููุฌูุฏุฉ ูู ุงููุดุฑูุน)
- ุฌุฏูู `0_stock_moves` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 2. ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช

ูู ุจุชุดุบูู ููู `migrations.sql` ูุฅูุดุงุก ุงูุฌุฏุงูู ุงููุทููุจุฉ:

```sql
-- ุฌุฏูู ุงูููุงู
CREATE TABLE IF NOT EXISTS `queue_jobs` (
  `id` INT AUTO_INCREMENT PRIMARY KEY,
  `start_trans_id` INT NOT NULL,
  `end_trans_id` INT NOT NULL,
  `status` ENUM('pending','processing','done','failed') DEFAULT 'pending',
  `attempts` INT NOT NULL DEFAULT 0,
  `locked_by` VARCHAR(100) DEFAULT NULL,
  `locked_at` DATETIME DEFAULT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ุฌุฏูู Checkpoints
CREATE TABLE IF NOT EXISTS `processed_checkpoints` (
  `id` INT AUTO_INCREMENT PRIMARY KEY,
  `last_trans_id` INT NOT NULL,
  `batch_size` INT NOT NULL DEFAULT 1000,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ุฌุฏูู ุงูุชูุงุฑูุฑ
CREATE TABLE IF NOT EXISTS `report_batches` (
  `id` INT AUTO_INCREMENT PRIMARY KEY,
  `from_id` INT NOT NULL,
  `to_id` INT NOT NULL,
  `file_path` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ุฌุฏูู ุงูุณุฌูุงุช
CREATE TABLE IF NOT EXISTS `queue_logs` (
  `id` INT AUTO_INCREMENT PRIMARY KEY,
  `job_id` INT NULL,
  `level` VARCHAR(20),
  `message` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 3. ุชูููู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช

ุนุฏูู ููู `db.php` ุจูุนูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจู:

```php
$dsn = "mysql:host=localhost;dbname=admin_meemkwdb;charset=utf8mb4";
$user = "root";
$pass = "";
```

### 4. ุงูุชุฃูุฏ ูู ุงูุตูุงุญูุงุช

ุชุฃูุฏ ูู ุฃู ูุฌูุฏ `reports` ูุงุจู ูููุชุงุจุฉ:

```bash
chmod 777 reports/
```

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุงูุทุฑููุฉ ุงูุฃููู: ูู ุฎูุงู ุงููุงุฌูุฉ (ููุตู ุจูุง)

1. ุงูุชุญ ุงููุชุตูุญ ูุงูุชูู ุฅูู: `http://localhost/tcpdf_job_queue_stock_moves_v2/`
2. ุณุชุธูุฑ ูู ููุญุฉ ุงูุชุญูู Dashboard
3. ุงุถุบุท ุนูู ุฒุฑ "๐ ุจุญุซ ุนู ุนูููุงุช ุฌุฏูุฏุฉ" ููุญุต ุงูุฌุฏูู ูุฅุถุงูุฉ ููุงู ุฌุฏูุฏุฉ
4. ุงุถุบุท ุนูู ุฒุฑ "โ๏ธ ุชูููุฏ ุงูุชูุงุฑูุฑ ุงูุฌุฏูุฏู" ููุนุงูุฌุฉ ุงูููุงู ูุชูููุฏ ูููุงุช PDF
5. ููููู ุงุณุชุฎุฏุงู ุฒุฑ "๐๏ธ ุฅุนุงุฏุฉ ุงุณุชุฎุฑุงุฌ ุงููููุงุช ูู ุงูุจุฏุงูู" ูุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู ุจุงููุงูู

### ุงูุทุฑููุฉ ุงูุซุงููุฉ: ูู ุฎูุงู ุณุทุฑ ุงูุฃูุงูุฑ

#### ุชุดุบูู Watcher (ูุญุต ุงูุฌุฏูู ูุฅุถุงูุฉ ููุงู):
```bash
php scripts/watcher.php
```

#### ุชุดุบูู Worker (ูุนุงูุฌุฉ ุงูููุงู):
```bash
php scripts/worker.php
```

### ุงูุทุฑููุฉ ุงูุซุงูุซุฉ: ูู ุฎูุงู API Endpoints

ููููู ุงุณุชุฏุนุงุก ุงูุนูููุงุช ูู ุฎูุงู AJAX ุฃู ุฃู HTTP client:

```javascript
// ุชุดุบูู Watcher
fetch('api/run_watcher.php')
  .then(response => response.json())
  .then(data => console.log(data));

// ุชุดุบูู Worker
fetch('api/run_worker.php')
  .then(response => response.json())
  .then(data => console.log(data));
```

### ุงูุทุฑููุฉ ุงูุฑุงุจุนุฉ: ุงูุชุดุบูู ุงูุชููุงุฆู ุนูุฏ ุจุฏุก Windows โญ (ููุตู ุจูุง)

ูุชุดุบูู ุงููุธุงู ุชููุงุฆูุงู ุนูุฏ ุจุฏุก ุชุดุบูู Windows:

#### ุฎุทูุฉ ูุงุญุฏุฉ ููุท:
```
ุงููุฑ ููุฑุงู ูุฒุฏูุฌุงู ุนูู: add_to_startup.bat
```

**โ ุชู! ุงููุธุงู ุณูุนูู ุชููุงุฆูุงู ุนูุฏ ูู ุชุดุบูู ููุฌูุงุฒ**

#### ุงููููุงุช ุงููุชุงุญุฉ:
- `start_system.bat` - ุชุดุบูู ูุฏูู (ูุน ูุงูุฐุฉ CMD)
- `start_system_silent.vbs` - ุชุดุบูู ูุฏูู (ุจุฏูู ูุงูุฐุฉ)
- `add_to_startup.bat` - ุฅุถุงูุฉ ููุชุดุบูู ุงูุชููุงุฆู
- `remove_from_startup.bat` - ุฅุฒุงูุฉ ูู ุงูุชุดุบูู ุงูุชููุงุฆู

#### ูููุฒูุฏ ูู ุงูุชูุงุตูู:
ุฑุงุฌุน ุงูุฏููู ุงููุงูู: `AUTO_START_GUIDE.md` ุฃู `QUICK_START_AR.md`

### ุงูุทุฑููุฉ ุงูุฎุงูุณุฉ: ุฌุฏููุฉ ุชููุงุฆูุฉ (Cron Job - Linux/Mac)

ูุชุดุบูู ุงููุธุงู ุชููุงุฆูุงู ูู 5 ุฏูุงุฆู ุนูู Linux/Macุ ุฃุถู ุฅูู Crontab:

```bash
# ุชุดุบูู Watcher ูู 5 ุฏูุงุฆู
*/5 * * * * php /path/to/project/scripts/watcher.php

# ุชุดุบูู Worker ูู ุฏูููุฉ
* * * * * php /path/to/project/scripts/worker.php
```

## ๐ ุขููุฉ ุงูุนูู

### 1. Watcher (ุงููุฑุงูุจ)
- ููุญุต ุฌุฏูู `0_stock_moves` ููุจุญุซ ุนู ุตููู ุฌุฏูุฏุฉ
- ุนูุฏูุง ูุฌุฏ 1000 ุตู ุฌุฏูุฏ ุฃู ุฃูุซุฑุ ูููู ุจู:
  - ุฅูุดุงุก ูููุฉ ุฌุฏูุฏุฉ ูู ุฌุฏูู `queue_jobs`
  - ุญูุธ ุขุฎุฑ `trans_id` ุชูุช ูุนุงูุฌุชู ูู `processed_checkpoints`
  - ุชุณุฌูู ุงูุนูููุฉ ูู `queue_logs`
- ูููู ุชุดุบููู ูู:
  - ูุงุฌูุฉ Dashboard (ุฒุฑ ุงูุจุญุซ)
  - API endpoint: `api/run_watcher.php`
  - ุณุทุฑ ุงูุฃูุงูุฑ: `php scripts/watcher.php`

### 2. Worker (ุงููุนุงูุฌ)
- ูุฌูุจ ุงูููุงู ุงููุนููุฉ ูู ุฌุฏูู `queue_jobs`
- ููู ูููุฉ:
  - ูุฌูุจ ุงูุจูุงูุงุช ูู `0_stock_moves`
  - ูููุฏ ููู PDF ุจุงุณุชุฎุฏุงู TCPDF
  - ูุญูุธ ุงูููู ูู ูุฌูุฏ `reports/`
  - ูุณุฌู ูุนูููุงุช ุงูุชูุฑูุฑ ูู `report_batches`
  - ูุญุฏุซ ุญุงูุฉ ุงููููุฉ ุฅูู `done` ุฃู `failed`
- ูููู ุชุดุบููู ูู:
  - ูุงุฌูุฉ Dashboard (ุฒุฑ ุงูุชูููุฏ)
  - API endpoint: `api/run_worker.php`
  - ุณุทุฑ ุงูุฃูุงูุฑ: `php scripts/worker.php`

### 3. Dashboard (ููุญุฉ ุงูุชุญูู)
- ุนุฑุถ ุฅุญุตุงุฆูุงุช ุงููุธุงู ูู ุงูููุช ุงููุนูู:
  - ุนุฏุฏ ุงูููุงู ุงููุนููุฉ
  - ุนุฏุฏ ุงูููุงู ููุฏ ุงููุนุงูุฌุฉ
  - ุนุฏุฏ ุงูููุงู ุงูููุชููุฉ
  - ุนุฏุฏ ุงูููุงู ุงููุงุดูุฉ
  - ุฅุฌูุงูู ุงูุชูุงุฑูุฑ ุงููููุฏุฉ
  - ุขุฎุฑ trans_id ุชูุช ูุนุงูุฌุชู
- ุนุฑุถ ุขุฎุฑ 10 ููุงู
- ุนุฑุถ ุขุฎุฑ 10 ุชูุงุฑูุฑ ูุน ุฑูุงุจุท ุงูุชุญููู
- ุนุฑุถ ุขุฎุฑ 20 ุณุฌู ูู ุงูุฃุญุฏุงุซ
- ุฃุฒุฑุงุฑ ุชุญูู ุณุฑูุนุฉ:
  - ุจุญุซ ุนู ุนูููุงุช ุฌุฏูุฏุฉ
  - ุชูููุฏ ุงูุชูุงุฑูุฑ ุงูุฌุฏูุฏุฉ
  - ุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู
  - ุชุญุฏูุซ ุงูุตูุญุฉ

## ๐ ุญุงูุงุช ุงูููุงู

- **pending**: ูููุฉ ุฌุฏูุฏุฉ ูู ุงูุชุธุงุฑ ุงููุนุงูุฌุฉ
- **processing**: ุงููููุฉ ููุฏ ุงููุนุงูุฌุฉ ุญุงููุงู
- **done**: ุงููููุฉ ุงูุชููุช ุจูุฌุงุญ
- **failed**: ุงููููุฉ ูุดูุช (ูุชู ุชุณุฌูู ุงูุฎุทุฃ)

## ๐จ ุชุฎุตูุต ุงูุชูุงุฑูุฑ

ููููู ุชุนุฏูู ุชุตููู ุงูุชูุงุฑูุฑ ูู ุฎูุงู ููู `classes/ReportGenerator.php`:

```php
// ุชุนุฏูู ุงูุฃููุงู
$html .= '<style>
    th {
        background-color: #4CAF50;  // ููู ุฑุฃุณ ุงูุฌุฏูู
        color: white;
    }
    tr:nth-child(even) {
        background-color: #f2f2f2;  // ููู ุงูุตููู ุงูุฒูุฌูุฉ
    }
</style>';
```

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ูุชู ุฅูุดุงุก ูููุงุช PDF

**ุงูุญููู:**
1. ุชุฃูุฏ ูู ุตูุงุญูุงุช ูุฌูุฏ `reports/`
2. ุชุญูู ูู ูุฌูุฏ ููุชุจุฉ TCPDF ูู `tcpdf/`
3. ุฑุงุฌุน ุณุฌู ุงูุฃุฎุทุงุก ูู ุฌุฏูู `queue_logs`

### ุงููุดููุฉ: ูุง ูุชู ุฅุถุงูุฉ ููุงู ุฌุฏูุฏุฉ

**ุงูุญููู:**
1. ุชุฃูุฏ ูู ูุฌูุฏ ุจูุงูุงุช ูู ุฌุฏูู `0_stock_moves`
2. ุชุญูู ูู ุฃู ุนุฏุฏ ุงูุตููู ุงูุฌุฏูุฏุฉ >= 1000
3. ุฑุงุฌุน ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู `db.php`

### ุงููุดููุฉ: ุงูููุงู ุชูุดู ุจุงุณุชูุฑุงุฑ

**ุงูุญููู:**
1. ุฑุงุฌุน ุฌุฏูู `queue_logs` ููุญุตูู ุนูู ุชูุงุตูู ุงูุฎุทุฃ
2. ุชุฃูุฏ ูู ุตุญุฉ ุจููุฉ ุฌุฏูู `0_stock_moves`
3. ุชุญูู ูู ุฐุงูุฑุฉ PHP ุงููุชุงุญุฉ (ูุฏ ุชุญุชุงุฌ ูุฒูุงุฏุฉ `memory_limit`)

## ๐ ุงูุฃุฏุงุก ูุงูุชุญุณููุงุช

- **ุญุฌู ุงูุฏูุนุฉ**: ุงูุชุฑุงุถูุงู 1000 ุตูุ ูููู ุชุนุฏููู ูู `Database.php`
- **ุนุฏุฏ ุงูููุงู ุงููุชุฒุงููุฉ**: Worker ูุนุงูุฌ 10 ููุงู ูุญุฏ ุฃูุตู ูู ุงููุฑุฉ ุงููุงุญุฏุฉ
- **ุงูุฐุงูุฑุฉ**: ุชุฃูุฏ ูู ุฃู `memory_limit` ูู PHP ูุงูู (ูููุตุญ ุจู 256M ุฃู ุฃูุซุฑ)
- **API Endpoints**: ุชุนูู ูู ุงูุฎูููุฉ ููุง ุชุญุฌุจ ุงููุณุชุฎุฏู
- **ุชุญุฏูุซ ุชููุงุฆู**: Dashboard ูุนูุฏ ุชุญููู ุงูุตูุญุฉ ุชููุงุฆูุงู ุจุนุฏ ุงูุนูููุงุช

## ๐ ุงูุฃูุงู

- โ ุงุณุชุฎุฏุงู Prepared Statements ูููุน SQL Injection
- โ ุชูุธูู ุงููุฏุฎูุงุช ุจุงุณุชุฎุฏุงู `htmlspecialchars()`
- โ ุงูุชุญูู ูู ุฃููุงุน ุงูุจูุงูุงุช
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุขูู

## ๐ ุงูุชุฑุฎูุต

ูุฐุง ุงููุดุฑูุน ููุชูุญ ุงููุตุฏุฑ ููููู ุงุณุชุฎุฏุงูู ุจุญุฑูุฉ.

## ๐จโ๐ป ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ

ุชู ุชุทููุฑ ูุฐุง ุงููุธุงู ุจุงุณุชุฎุฏุงู:
- **PHP 8.2** - ูุบุฉ ุงูุจุฑูุฌุฉ ุงูุฃุณุงุณูุฉ
- **MySQL** - ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **TCPDF Library** - ุชูููุฏ ูููุงุช PDF
- **Object-Oriented Programming (OOP)** - ููุท ุงูุจุฑูุฌุฉ
- **Job Queue Pattern** - ููุท ุฅุฏุงุฑุฉ ุงูููุงู
- **AJAX & Fetch API** - ุงูุชูุงุนู ูุน ุงูุฎุงุฏู
- **Bootstrap CSS** - ุชูุณูู ุงููุงุฌูุฉ
- **Native JavaScript** - ุงูุจุฑูุฌุฉ ุงูุฃูุงููุฉ

## ๐ ุงูุฏุนู

ููุญุตูู ุนูู ุงููุณุงุนุฏุฉ ุฃู ุงูุฅุจูุงุบ ุนู ูุดุงููุ ูุฑุฌู ูุฑุงุฌุนุฉ:
- ุฌุฏูู `queue_logs` ููุฃุฎุทุงุก
- ููุญุฉ ุงูุชุญูู Dashboard ููุฅุญุตุงุฆูุงุช
- ูููุงุช ุงูุณุฌูุงุช ูู ูุฌูุฏ `logs/`

---

**ููุงุญุธุฉ**: ุชุฃูุฏ ูู ุชุดุบูู `migrations.sql` ูุจู ุงุณุชุฎุฏุงู ุงููุธุงู ูุฃูู ูุฑุฉ!
